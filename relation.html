<html>
    <head>
        <title>D3 Force Layout Example 1</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="main.css">
        <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
        <script type='text/javascript' src="http://code.jquery.com/ui/1.11.0/jquery-ui.min.js"> </script>
        <script type='text/javascript' src="http://code.jquery.com/ui/1.11.0/themes/smoothness/jquery-ui.css"> </script>
        <script type='text/javascript' src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"> </script>


<script type="application/json" id="ufo">
    {
        "nodes": [{
            "name": "Unkown",
                "group": 1
        }, {
            "name": "Lights",
            "group": 2
        }, {
            "name": "Sky",
                "group": 2
        }, {
            "name": "Object",
                "group": 2
        }, {
            "name": "Moving",
                "group": 2
        }, {
            "name": "Bright",
                "group": 2
        }, {
            "name": "White",
                "group": 2
        }, {
            "name": "Red",
                "group": 2
        }, {
            "name": "Flying",
                "group": 2
        }, {
            "name": "Night",
                "group": 2
        }, {
            "name": "Orange",
                "group": 2
            }, {
                "name": "Triangle",
                "group": 1
            }, {
                "name": "Craft",
                    "group": 2
            }, {
                "name": "Shaped",
                    "group": 2
        }],
            "links": [{
            "source": 1,
                "target": 0,
                "value": 14.76
        }, {
            "source": 2,
                "target": 0,
                "value": 11.40
        }, {
            "source": 3,
                "target": 0,
                "value": 10.12
        }, {
            "source": 4,
                "target": 0,
                "value": 6.69
        }, {
            "source": 5,
                "target": 0,
                "value": 6.51
        }, {
            "source": 6,
                "target": 0,
                "value": 4.49
        }, {
            "source": 7,
                "target": 0,
                "value": 4.03
        }, {
            "source": 8,
                "target": 0,
                "value": 3.41
        }, {
            "source": 9,
                "target": 0,
                "value": 3.25
        }, {
            "source": 10,
                "target": 0,
                "value": 2.96
            }, {
                "source": 1,
                    "target": 11,
                    "value": 26.74
            }, {
                "source": 3,
                    "target": 11,
                    "value": 15.28
            }, {
                "source": 12,
                    "target": 11,
                    "value": 13.86
            }, {
                "source": 13,
                    "target": 11,
                    "value": 12.75
            }, {
                "source": 5,
                    "target": 11,
                    "value": 6.15
            }, {
                "source": 4,
                    "target": 11,
                    "value": 4.03
            }, {
                "source": 6,
                    "target": 11,
                    "value": 7.18
            }, {
                "source": 7,
                    "target": 11,
                    "value": 6.69
            }, {
                "source": 8,
                    "target": 11,
                    "value": 6.68
            }, {
                "source": 2,
                    "target": 11,
                    "value": 10.05
        }]
    }
</script>
<!--comment to fix git-->
<div class="topnav">
    <a href="index.html">Wordle</a>
    <a class="active" href="relation.html">Word Relation</a>
    <a href="map.html">Location Data</a>

  </div>
  <div class="ui-widget">
    <input id="search">
     <button type="button" onclick="searchNode()">Search</button>
 </div>

    </head>
    <body>
        <script>

//Constants for the SVG
var width = 500,
    height = 500;

//Set up the colour scale
var color = d3.scale.category20();

//Set up the force layout
var force = d3.layout.force()
    .charge(-120)
    .linkDistance(30)
    .size([width, height]);

//Append a SVG to the body of the html page. Assign this SVG as an object to svg
var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);



//Read the data from the mis element 
var ufo = document.getElementById('ufo').innerHTML;
graph = JSON.parse(ufo);

//Creates the graph data structure out of the json data
force.nodes(graph.nodes)
    .links(graph.links)
    .start();

//Create all the line svgs but without locations yet
var link = svg.selectAll(".link")
    .data(graph.links)
    .enter().append("line")
    .attr("class", "link")
    .style("stroke-width", function (d) {
    return Math.sqrt(d.value);
});

//Do the same with the circles for the nodes - no 
//Changed
var node = svg.selectAll(".node")
    .data(graph.nodes)
    .enter().append("g")
    .attr("class", "node")
    .call(force.drag);
node.append("circle")
    .attr("r", 8)
    .style("fill", function (d) {
    return color(d.group);
})
node.append("text")
      .attr("dx", 10)
      .attr("dy", ".35em")
      .text(function(d) { return d.name })
      .style("stroke", "black");



//Now we are giving the SVGs co-ordinates - the force layout is generating the co-ordinates which this code is using to update the attributes of the SVG elements
force.on("tick", function () {
    link.attr("x1", function (d) {
        return d.source.x;
    })
        .attr("y1", function (d) {
        return d.source.y;
    })
        .attr("x2", function (d) {
        return d.target.x;
    })
        .attr("y2", function (d) {
        return d.target.y;
    });
    d3.selectAll("circle").attr("cx", function (d) {
        return d.x;
    })
        .attr("cy", function (d) {
        return d.y;
    });
    d3.selectAll("text").attr("x", function (d) {
        return d.x;
    })
        .attr("y", function (d) {
        return d.y;
    });
});


// source or target properties match the hovered node.
node.on('mouseover', function(d) {
  link.style('stroke-width', function(l) {
    if (d === l.source || d === l.target)
      return 8;
    else
      return 2;
    });
});



// Set the stroke width back to normal when mouse leaves the node.
node.on('mouseout', function() {
  link.style('stroke-width', 2);
});


var optArray = [];
for (var i = 0; i < graph.nodes.length - 1; i++) {
    optArray.push(graph.nodes[i].name);
}

optArray = optArray.sort();

$(function () {
    $("#search").autocomplete({
        source: optArray
    });
});


function searchNode() {

    //find the node

    var selectedVal = document.getElementById('search').value;
    var node = svg.selectAll(".node");

    if (selectedVal == "none") {
        node.style("stroke", "white").style("stroke-width", "1");
    } else {
        var selected = node.filter(function (d, i) {
            return d.name != selectedVal;
        });
        selected.style("opacity", "0");
        var link = svg.selectAll(".link")
        link.style("opacity", "0");
        d3.selectAll(".node, .link").transition()
            .duration(5000)
            .style("opacity", 1);


    }
}
            
        </script>
    </body>
</html>